<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Currency Chart</title>
</head>
<body>
<script src="scripts/jquery-3.3.1.min.js" type="text/javascript"></script>
<script src="scripts/jquery.signalr-2.4.1.min.js" type="text/javascript"></script>
<script src="scripts/chart.min.js" type="text/javascript"></script>
<script src="../signalr/hubs" type="text/javascript"></script>
<script>
    $(function () {
        var chartHub = $.connection.chart;

        
        $.connection.hub.start().done(function () {
            chartHub.server.initChartData();
        });

        var canvas = document.getElementById('lineCanvas'),
            ctx = canvas.getContext('2d'),
            chart = new Chart(ctx, lineChartData),
            chartDatas = chart.data.datasets;

        chartHub.client.addMessage = function (time, message) {
            $('#messages').append('<tr><td>' + time + '</td><td>'+ message + '</td></tr>');
        };
        
        chartHub.client.updateChart = function (data) {

            chartDatas[0].data.push(data.lineChartData[0]);
            chartDatas[1].data.push(data.lineChartData[1]);
            chartDatas[2].data.push(data.lineChartData[2]);
            if (chartDatas[0].data.length > 10) {
                chartDatas[0].data.splice(0, 1);
                chartDatas[1].data.splice(0, 1);
                chartDatas[2].data.splice(0, 1);
            }
            chart.update();

        };
    });
    var lineChartData = {
        type: "line",
        data: {
            labels: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"],
            color: ["red", "green", "blue"],
            datasets: [
                {label: "First", data: [0], fill: false, borderColor: '#4dc9f6'},
                {label: "Second", data: [0], fill: false, borderColor: '#f67019'},
                {label: "Third", data: [0], fill: false, borderColor: '#f53794'},
            ]
        },
        options: {
            responsive: true,
            animation: false,
            title: {
                display: true,
                fontSize: 18,
                text: 'Currency Chart'
            }
        }
    }
</script>



<table style="width: 100%">
    <tr>
        <td style="width: 75%; text-align: center">
            <canvas id="lineCanvas" height="200" width="400">Chart is Loading...</canvas>
        </td>
        <td style="width: 25%; text-align: center">
            <div style="overflow: scroll; height: 800px">
                <table border="1" id="messages">
                    <thead>
                    <tr>
                        <td><b>Time</b></td>
                        <td><b>Message</b></td>
                    </tr>
                    </thead>

                    @Each.Messages
                    <tr>
                        <td>@Current.Created</td>
                        <td>@Current.Message</td>
                    </tr>
                    @EndEach
                </table>
            </div>
        </td>
    </tr>
</table>

</body>
</html>