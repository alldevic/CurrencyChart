<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Currency Chart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="Content/bootstrap.min.css" type="text/css">
</head>

<body>
<script src="scripts/jquery-3.3.1.min.js" type="text/javascript"></script>
<script src="scripts/jquery.signalr-2.4.1.min.js" type="text/javascript"></script>
<script src="scripts/chart.min.js" type="text/javascript"></script>
<script src="../signalr/hubs" type="text/javascript"></script>
<script>
    $(function () {
        var chartHub = $.connection.chart;


        $.connection.hub.start().done(function () {
            chartHub.server.initChartData();
        });

        var canvas = document.getElementById('lineCanvas'),
            ctx = canvas.getContext('2d'),
            chart = new Chart(ctx, lineChartData),
            chartDatas = chart.data.datasets;

        chartHub.client.addMessage = function (time, message) {
            $('#messages').append('<tr><td>' + time + '</td><td>' + message + '</td></tr>');
        };

        chartHub.client.updateChart = function (data) {

            chartDatas[0].data.push(data.lineChartData[0]);
            chartDatas[1].data.push(data.lineChartData[1]);
            chartDatas[2].data.push(data.lineChartData[2]);
            if (chartDatas[0].data.length > 10) {
                chartDatas[0].data.splice(0, 1);
                chartDatas[1].data.splice(0, 1);
                chartDatas[2].data.splice(0, 1);
            }
            chart.update();

        };
    });
    var lineChartData = {
        type: "line",
        data: {
            labels: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"],
            color: ["red", "green", "blue"],
            datasets: [
                {label: "First", data: [0], fill: false, borderColor: '#4dc9f6'},
                {label: "Second", data: [0], fill: false, borderColor: '#f67019'},
                {label: "Third", data: [0], fill: false, borderColor: '#f53794'},
            ]
        },
        options: {
            responsive: true,
            animation: false
        }
    }
</script>


<nav class="navbar navbar-expand-md navbar-light">
    <div class="container">
        <button class="navbar-toggler navbar-toggler-right border-0" type="button" data-toggle="collapse"
                data-target="#navbar7">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbar7"><a class="navbar-brand text-primary d-none d-md-block"
                                                              href="#">
            <b>Currency Chart</b>
        </a>
            <ul class="navbar-nav mx-auto">
                <li class="nav-item"><a class="nav-link" href="#">RUB/USD</a></li>
                <li class="nav-item"><a class="nav-link" href="#">RUB/EUR</a></li>
                <li class="nav-item"><a class="nav-link" href="#">RUB/CYN</a></li>
            </ul>
        </div>
    </div>
</nav>
<div class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h2 class="">RUB/USD</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-md-8">
                <canvas id="lineCanvas" height="300" width="400">Chart is Loading...</canvas>
            </div>
            <div class="col-md-4" style="overflow-y: scroll; height:60vh">
                <div class="table-responsive">
                    <table class="table table-striped table-borderless table-sm" style="overflow-y: scroll;"
                           id="messages">
                        <thead>
                        <tr>
                            <th scope="col">First</th>
                            <th scope="col">Last</th>
                        </tr>
                        </thead>
                        <tbody>
                        @Each.Messages
                        <tr>
                            <td>@Current.Created</td>
                            <td>@Current.Message</td>
                        </tr>
                        @EndEach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="scripts/bootstrap.min.js"></script>
</body>
</html>